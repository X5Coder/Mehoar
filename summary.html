<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PDF Summarizer Pro</title>
<style>
    :root {
        --primary-color: #3498db;
        --secondary-color: #2c3e50;
        --accent-color: #e74c3c;
        --light-bg: #f8f9fa;
        --border-color: #ddd;
    }
    
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: 'Arial', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
        direction: rtl;
    }
    
    .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
        overflow: hidden;
    }
    
    header {
        background: var(--secondary-color);
        color: white;
        padding: 25px 40px;
        text-align: center;
    }
    
    header h1 {
        font-size: 32px;
        margin-bottom: 10px;
        font-weight: 700;
    }
    
    header p {
        font-size: 16px;
        opacity: 0.9;
    }
    
    .upload-section {
        padding: 40px;
        border-bottom: 2px solid var(--light-bg);
    }
    
    .file-input-wrapper {
        position: relative;
        max-width: 600px;
        margin: 0 auto 30px;
    }
    
    .file-input-wrapper input[type="file"] {
        width: 100%;
        padding: 25px 20px;
        border: 3px dashed var(--primary-color);
        border-radius: 15px;
        font-size: 18px;
        background: var(--light-bg);
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .file-input-wrapper input[type="file"]:hover {
        border-color: #2980b9;
        background: #ecf0f1;
    }
    
    .action-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .btn {
        padding: 15px 35px;
        font-size: 18px;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        min-width: 180px;
    }
    
    .btn-primary {
        background: var(--primary-color);
        color: white;
    }
    
    .btn-primary:hover {
        background: #2980b9;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
    }
    
    .btn-secondary {
        background: #95a5a6;
        color: white;
    }
    
    .btn-secondary:hover {
        background: #7f8c8d;
        transform: translateY(-3px);
    }
    
    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none !important;
    }
    
    .loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }
    
    .loading-content {
        background: white;
        padding: 40px;
        border-radius: 15px;
        text-align: center;
        max-width: 400px;
    }
    
    .spinner {
        border: 5px solid #f3f3f3;
        border-top: 5px solid var(--primary-color);
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .results-section {
        display: none;
        padding: 40px;
        min-height: 600px;
    }
    
    .results-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
        margin-top: 30px;
    }
    
    @media (min-width: 992px) {
        .results-grid {
            grid-template-columns: 1fr 1fr;
        }
    }
    
    .result-card {
        background: white;
        border: 2px solid var(--border-color);
        border-radius: 15px;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
        position: relative;
    }
    
    .result-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .card-header {
        background: var(--light-bg);
        padding: 20px;
        border-bottom: 2px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .card-header h3 {
        color: var(--secondary-color);
        font-size: 22px;
        margin: 0;
    }
    
    .card-tools {
        display: flex;
        gap: 10px;
    }
    
    .tool-btn {
        background: none;
        border: 2px solid var(--primary-color);
        color: var(--primary-color);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: all 0.3s;
    }
    
    .tool-btn:hover {
        background: var(--primary-color);
        color: white;
        transform: scale(1.1);
    }
    
    .tool-btn.active {
        background: var(--primary-color);
        color: white;
    }
    
    .card-content {
        padding: 25px;
        max-height: 500px;
        overflow-y: auto;
    }
    
    .raw-content {
        font-size: 18px;
        line-height: 1.8;
        color: #2c3e50;
    }
    
    .raw-content .highlight {
        background-color: #ffeaa7;
        padding: 2px 5px;
        border-radius: 3px;
        transition: background-color 0.3s;
    }
    
    .summary-content {
        font-size: 20px;
        line-height: 1.9;
        color: #2c3e50;
        text-align: justify;
        padding: 10px;
    }
    
    .summary-content.zoomed {
        font-size: 24px;
        line-height: 2;
    }
    
    .summary-content .word-highlight {
        background-color: #a29bfe;
        padding: 2px 4px;
        border-radius: 3px;
        transition: background-color 0.3s;
    }
    
    .controls-panel {
        background: var(--light-bg);
        padding: 20px;
        border-radius: 15px;
        margin-top: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .zoom-controls, .color-picker {
        display: flex;
        gap: 10px;
        align-items: center;
    }
    
    .zoom-btn {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 2px solid var(--primary-color);
        background: white;
        color: var(--primary-color);
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
    }
    
    .zoom-btn:hover {
        background: var(--primary-color);
        color: white;
    }
    
    .color-options {
        display: none;
        position: absolute;
        top: -60px;
        left: 0;
        background: white;
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        z-index: 100;
    }
    
    .color-options.show {
        display: flex;
        gap: 8px;
    }
    
    .color-option {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid #ddd;
        transition: transform 0.2s;
    }
    
    .color-option:hover {
        transform: scale(1.2);
    }
    
    .color-blue { background: #3498db; }
    .color-red { background: #e74c3c; }
    .color-green { background: #2ecc71; }
    .color-yellow { background: #f1c40f; }
    .color-purple { background: #9b59b6; }
    
    .drawing-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 999;
    }
    
    .drawing-mode .drawing-canvas {
        pointer-events: auto;
        cursor: crosshair;
    }
    
    .drawing-mode body {
        cursor: crosshair;
    }
    
    .pen-tooltip {
        position: fixed;
        background: var(--secondary-color);
        color: white;
        padding: 10px 15px;
        border-radius: 5px;
        font-size: 14px;
        z-index: 1001;
        display: none;
    }
    
    .error-message {
        background: #fadbd8;
        color: #c0392b;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 0;
        text-align: center;
        display: none;
    }
    
    .success-message {
        background: #d5f4e6;
        color: #27ae60;
        padding: 15px;
        border-radius: 10px;
        margin: 20px 0;
        text-align: center;
        display: none;
    }
    
    .status-bar {
        padding: 15px;
        background: var(--light-bg);
        border-radius: 10px;
        margin-top: 20px;
        text-align: center;
        font-weight: bold;
        color: var(--secondary-color);
    }
    
    .raw-content ul {
        list-style-type: none;
        padding-right: 20px;
    }
    
    .raw-content li {
        margin-bottom: 15px;
        padding-right: 15px;
        position: relative;
        font-size: 18px;
        line-height: 1.6;
    }
    
    .raw-content li:before {
        content: "â€¢";
        color: var(--primary-color);
        font-size: 24px;
        position: absolute;
        right: -15px;
        top: -2px;
    }
    
    .summary-content {
        font-size: 20px;
        line-height: 1.9;
        color: #2c3e50;
        text-align: justify;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 10px;
        border: 1px solid #e9ecef;
    }
    
    .summary-content.zoomed {
        font-size: 24px;
        line-height: 2.1;
    }
    
    .summary-content .word-highlight {
        background-color: #a29bfe;
        padding: 2px 4px;
        border-radius: 3px;
        transition: all 0.3s;
        animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
        0% { background-color: #a29bfe; }
        50% { background-color: #6c5ce7; }
        100% { background-color: #a29bfe; }
    }
    
    .audio-controls {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .volume-slider {
        width: 100px;
        height: 5px;
        background: #ddd;
        border-radius: 5px;
        outline: none;
        opacity: 0.7;
        transition: opacity .2s;
    }
    
    .volume-slider:hover {
        opacity: 1;
    }
    
    .volume-slider::-webkit-slider-thumb {
        width: 15px;
        height: 15px;
        border-radius: 50%;
        background: var(--primary-color);
        cursor: pointer;
    }
    
    .highlighted-word {
        background-color: #ffd700 !important;
        animation: highlightFlash 0.5s;
    }
    
    @keyframes highlightFlash {
        0% { background-color: transparent; }
        50% { background-color: #ffd700; }
        100% { background-color: #ffd700; }
    }
</style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“š Ù…Ù„Ø®Øµ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù…Ù„ÙØ§Øª PDF</h1>
            <p>Ø£Ø¯ÙˆØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„ØªØ­Ù„ÙŠÙ„ ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ ÙˆØ§Ù„Ø±Ø³Ù… Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</p>
        </header>
        
        <section class="upload-section">
            <div class="file-input-wrapper">
                <input type="file" id="pdfFile" accept=".pdf" />
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="sendFile()" id="submitBtn">
                    <span>ğŸ“¤ Ø±ÙØ¹ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</span>
                </button>
                <button class="btn btn-secondary" onclick="resetApp()">
                    <span>ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</span>
                </button>
            </div>
            
            <div class="status-bar" id="status"></div>
        </section>
        
        <section class="results-section" id="resultsSection">
            <div class="results-grid">
                <div class="result-card" id="rawCard">
                    <div class="card-header">
                        <h3>ğŸ“‹ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
                        <div class="card-tools">
                            <button class="tool-btn" onclick="copyToClipboard('rawContent')" title="Ù†Ø³Ø® Ø§Ù„Ù†Ù‚Ø§Ø·">
                                ğŸ“‹
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="raw-content" id="rawContent"></div>
                    </div>
                </div>
                
                <div class="result-card" id="summaryCard">
                    <div class="card-header">
                        <h3>ğŸ“„ Ø§Ù„ØªÙ„Ø®ÙŠØµ Ø§Ù„ÙƒØ§Ù…Ù„</h3>
                        <div class="card-tools">
                            <button class="tool-btn" onclick="toggleZoom()" id="zoomBtn" title="ØªÙƒØ¨ÙŠØ±/ØªØµØºÙŠØ±">
                                ğŸ”
                            </button>
                            <button class="tool-btn" onclick="toggleAudio()" id="audioBtn" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª">
                                ğŸ”Š
                            </button>
                            <button class="tool-btn" onclick="copyToClipboard('summaryContent')" title="Ù†Ø³Ø® Ø§Ù„ØªÙ„Ø®ÙŠØµ">
                                ğŸ“‹
                            </button>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="summary-content" id="summaryContent"></div>
                    </div>
                </div>
            </div>
            
            <div class="controls-panel">
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomIn()">+</button>
                    <span id="zoomLevel">100%</span>
                    <button class="zoom-btn" onclick="zoomOut()">-</button>
                </div>
                
                <div class="color-picker" style="position: relative;">
                    <button class="tool-btn" id="penBtn" title="ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ Ø£Ø¯Ø§Ø© Ø§Ù„Ø±Ø³Ù…"
                            onmousedown="startPenHold()" 
                            ontouchstart="startPenHold()"
                            onmouseup="clearPenHold()"
                            ontouchend="clearPenHold()">
                        âœï¸
                    </button>
                    <div class="color-options" id="colorOptions">
                        <div class="color-option color-blue" data-color="#3498db" onclick="selectColor(this)"></div>
                        <div class="color-option color-red" data-color="#e74c3c" onclick="selectColor(this)"></div>
                        <div class="color-option color-green" data-color="#2ecc71" onclick="selectColor(this)"></div>
                        <div class="color-option color-yellow" data-color="#f1c40f" onclick="selectColor(this)"></div>
                        <div class="color-option color-purple" data-color="#9b59b6" onclick="selectColor(this)"></div>
                    </div>
                </div>
                
                <div class="audio-controls" id="audioControls" style="display: none;">
                    <span>ğŸ”Š Ø§Ù„ØµÙˆØª:</span>
                    <input type="range" min="0" max="1" step="0.1" value="0.5" 
                           class="volume-slider" id="volumeSlider" onchange="changeVolume(this.value)">
                    <button class="tool-btn" onclick="stopAudio()" title="Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª">
                        â¹ï¸
                    </button>
                </div>
            </div>
        </section>
        
        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>
    </div>
    
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ PDF...</h3>
            <p>Ù‚Ø¯ ØªØ³ØªØºØ±Ù‚ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ø¶Ø¹ Ù„Ø­Ø¸Ø§Øª</p>
        </div>
    </div>
    
    <canvas class="drawing-canvas" id="drawingCanvas"></canvas>
    <div class="pen-tooltip" id="penTooltip">Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù„ÙˆÙ†</div>

<script>
// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ±
const SERVER = "https://wet-aidan-kimon-66eadaf6.koyeb.app";
const ID = "12345";
const PASS = "12345abcde57";

// Ø§Ù„Ø¨Ø±ÙˆÙ…Øª Ø§Ù„Ù…Ø­Ø¯Ø«
const PROMPT = `ROLE:
You are an AI specialized in **strict PDF analysis and summarization** following Google Gemini Flash 2.5 Lite standards.
You must strictly follow the instructions below with ZERO deviation.

========================
INPUT VARIABLES (IN ARABIC):
========================
Ù„ØºØ©_Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬        = Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
Ø§Ù„Ù„Ù‡Ø¬Ø©             = Ø§Ù„ÙØµØ­Ù‰
Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø´Ø±Ø­        = Ù…ÙØµÙ„ ÙˆØ´Ø§Ù…Ù„
Ø´Ø®ØµÙŠØ©_Ø§Ù„Ø´Ø§Ø±Ø­       = Ø®Ø¨ÙŠØ± Ù…ØªØ®ØµØµ
ØªØ¹Ù„ÙŠÙ‚_Ø§Ø®ØªÙŠØ§Ø±ÙŠ      = 

========================
TASK:
========================
1. Analyze the provided PDF **from the first word to the last word only**.
2. Operate in **closed-book mode**: only PDF content can be used; external knowledge is forbidden.
3. Do NOT infer, guess, or add explanations not present in the PDF.
4. If the PDF is empty, corrupted, unreadable, or has no meaningful content â†’ return the fallback JSON exactly as defined below.
5. Generate a **full summary** with **complete coverage** of the PDF:
   - The AI has **freedom to determine the length** of the summary based on the file size and content complexity.
   - If the PDF is large â†’ produce a detailed, longer summary covering every part.
   - If the PDF is small â†’ produce a concise summary covering all key points.
   - The goal is a **self-sufficient summary** that allows the user to understand all important content **without reading the full PDF**.
   - Explanation level: Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø´Ø±Ø­
   - Explainer persona: Ø´Ø®ØµÙŠØ©_Ø§Ù„Ø´Ø§Ø±Ø­
   - Output language: Ù„ØºØ©_Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬
   - Dialect: Ø§Ù„Ù„Ù‡Ø¬Ø©
   - Optional comment: ØªØ¹Ù„ÙŠÙ‚_Ø§Ø®ØªÙŠØ§Ø±ÙŠ (ignore if empty)
   - The style must fully match the user-selected level and persona.

6. **RAW field rules**:
   - Extract **3â€“10 sentences**, not questions, but **direct statements summarizing the key content, laws, rules, or insights** from the PDF.
   - **Priority:** Any explicit rules, laws, or constraints in the PDF come first, then include the most important points or conclusions.
   - All sentences must be understandable **alone** and **directly traceable to PDF content**.
   - RAW must be derived solely from the PDF; no external knowledge, examples, or interpretations are allowed.
   - Minimum 3 sentences, maximum 10 sentences.

========================
OUTPUT FORMAT (STRICT):
========================
- Output MUST be **VALID JSON ONLY**
- No Markdown
- No extra text
- No comments
- Keys must appear **exactly in this order**

========================
JSON SCHEMA:
========================
{
  "head": "",
  "raw": [],
  "page": ""
}

========================
FIELD RULES:
========================
1. head:
   - Exactly 5 words
   - Represents the PDF content accurately
   - Written in Ù„ØºØ©_Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬

2. raw:
   - Array of **direct statements**, not questions
   - Minimum 3 items, maximum 10 items
   - Priority:
     a) Explicit rules, laws, or constraints in the PDF
     b) If none exist, summarize the most useful points or insights clearly
   - Must be understandable **alone** without reading the full summary
   - Written in the specified language, dialect, and style

3. page:
   - Full detailed explanation of the summary
   - Must follow **Ø´Ø®ØµÙŠØ©_Ø§Ù„Ø´Ø§Ø±Ø­** explaining in **Ù…Ø³ØªÙˆÙ‰_Ø§Ù„Ø´Ø±Ø­**
   - Strictly based on PDF content only
   - Must cover **everything in the PDF**; nothing should be skipped
   - No added knowledge or interpretation
   - **The AI may determine the summary length freely** to ensure full coverage and user self-sufficiency

========================
FAILURE / EMPTY PDF RESPONSE (MANDATORY):
========================
If the PDF is empty, unreadable, or invalid, RETURN EXACTLY:

{
  "head": "Not Output",
  "raw": "Not Output",
  "page": "Not Output"
}

========================
ABSOLUTE CONSTRAINTS:
========================
- Do NOT output anything except the final JSON
- Do NOT mention instructions or analysis steps
- Do NOT hallucinate or guess
- Be strict, literal, and deterministic
- Every output sentence must be semantically traceable to the PDF`;

// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
let currentZoom = 1;
let isAudioPlaying = false;
let isDrawingMode = false;
let currentColor = '#3498db';
let speechSynthesis = null;
let currentUtterance = null;
let drawings = [];
let isPenHold = false;
let penHoldTimeout = null;
let isColorPickerVisible = false;

// ØªÙ‡ÙŠØ¦Ø© Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø³Ù…
const canvas = document.getElementById('drawingCanvas');
const ctx = canvas.getContext('2d');
let isDrawing = false;
let lastX = 0;
let lastY = 0;

// ÙˆØ¸ÙŠÙØ© Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù
async function sendFile() {
    const fileInput = document.getElementById('pdfFile');
    const submitBtn = document.getElementById('submitBtn');
    const statusEl = document.getElementById('status');
    const loadingEl = document.getElementById('loadingOverlay');
    const resultsSection = document.getElementById('resultsSection');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    
    const file = fileInput.files[0];
    if (!file) {
        showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹');
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
    if (!file.type.includes('pdf') && !file.name.toLowerCase().endsWith('.pdf')) {
        showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù PDF ØµØ§Ù„Ø­');
        return;
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 25MB)
    if (file.size > 25 * 1024 * 1024) {
        showError('Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 25MB');
        return;
    }
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<span>â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</span>';
    loadingEl.style.display = 'flex';
    statusEl.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù...';
    errorMessage.style.display = 'none';
    successMessage.style.display = 'none';
    
    try {
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ Base64
        const base64 = await readFileAsBase64(file);
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
        const requestData = {
            id: ID,
            pass: PASS,
            data: PROMPT,
            PDF_BASE64: base64
        };
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±
        const response = await fetch(SERVER + "/api/KIMO_DEV", {
            method: "POST",
            headers: { 
                "Content-Type": "application/json",
                "Accept": "application/json"
            },
            body: JSON.stringify(requestData)
        });
        
        if (!response.ok) {
            throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±: ${response.status}`);
        }
        
        const responseText = await response.text();
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ù„ÙŠÙ„ JSON
        try {
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ Ù…Ù† Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ ØºÙŠØ± JSON
            let jsonText = responseText.trim();
            
            // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù†Øµ Ù‚Ø¨Ù„ Ø£Ùˆ Ø¨Ø¹Ø¯ Ø§Ù„Ù€ JSON
            const jsonMatch = jsonText.match(/\{[\s\S]*\}/);
            if (jsonMatch) {
                jsonText = jsonMatch[0];
            }
            
            const data = JSON.parse(jsonText);
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ÙØ´Ù„
            if (data.head === "Not Output" && data.raw === "Not Output" && data.page === "Not Output") {
                showError('Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø£Ùˆ ÙØ§Ø±Øº');
                return;
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            displayResults(data);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            resultsSection.style.display = 'block';
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
            successMessage.textContent = 'âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬';
            successMessage.style.display = 'block';
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø©
            statusEl.textContent = `âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: ${file.name} (${formatFileSize(file.size)})`;
            
            // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            resultsSection.scrollIntoView({ behavior: 'smooth' });
            
        } catch (parseError) {
            console.error('JSON Parse Error:', parseError);
            showError('Ø®Ø·Ø£ ÙÙŠ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø¯ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±');
        }
        
    } catch (error) {
        console.error('Error:', error);
        showError(`Ø®Ø·Ø£: ${error.message}`);
    } finally {
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<span>ğŸ“¤ Ø±ÙØ¹ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</span>';
        loadingEl.style.display = 'none';
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
function displayResults(data) {
    const rawContent = document.getElementById('rawContent');
    const summaryContent = document.getElementById('summaryContent');
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    if (Array.isArray(data.raw)) {
        let rawHtml = '<ul>';
        data.raw.forEach(item => {
            rawHtml += `<li>${item}</li>`;
        });
        rawHtml += '</ul>';
        rawContent.innerHTML = rawHtml;
    } else if (typeof data.raw === 'string') {
        rawContent.innerHTML = `<p>${data.raw}</p>`;
    }
    
    // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ„Ø®ÙŠØµ Ø§Ù„ÙƒØ§Ù…Ù„
    summaryContent.innerHTML = data.page || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰';
    
    // Ø¥Ø¶Ø§ÙØ© Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙƒØ¨ÙŠØ±
    summaryContent.classList.remove('zoomed');
    currentZoom = 1;
    document.getElementById('zoomLevel').textContent = '100%';
    
    // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØµÙˆØª Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„
    stopAudio();
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±Ø³Ù…
    resetDrawing();
}

// Ø¯Ø§Ù„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù ÙƒÙ€ Base64
function readFileAsBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            resolve(reader.result.split(',')[1]);
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

// Ø¯Ø§Ù„Ø© Ù†Ø³Ø® Ø§Ù„Ù†Øµ
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.innerText || element.textContent;
    
    navigator.clipboard.writeText(text).then(() => {
        showTemporaryMessage('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©');
    }).catch(err => {
        console.error('Failed to copy:', err);
        showError('âŒ ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ù†Øµ');
    });
}

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙƒØ¨ÙŠØ±/Ø§Ù„ØªØµØºÙŠØ±
function toggleZoom() {
    const summaryContent = document.getElementById('summaryContent');
    const zoomBtn = document.getElementById('zoomBtn');
    
    if (currentZoom === 1) {
        // ØªÙƒØ¨ÙŠØ±
        currentZoom = 1.2;
        summaryContent.classList.add('zoomed');
        zoomBtn.textContent = 'ğŸ”';
        zoomBtn.title = "ØªØµØºÙŠØ±";
    } else {
        // ØªØµØºÙŠØ±
        currentZoom = 1;
        summaryContent.classList.remove('zoomed');
        zoomBtn.textContent = 'ğŸ”';
        zoomBtn.title = "ØªÙƒØ¨ÙŠØ±";
    }
    
    document.getElementById('zoomLevel').textContent = `${Math.round(currentZoom * 100)}%`;
}

function zoomIn() {
    const summaryContent = document.getElementById('summaryContent');
    currentZoom += 0.1;
    if (currentZoom > 2) currentZoom = 2;
    
    if (currentZoom > 1) {
        summaryContent.classList.add('zoomed');
        summaryContent.style.fontSize = `${20 * currentZoom}px`;
    } else {
        summaryContent.classList.remove('zoomed');
    }
    
    document.getElementById('zoomLevel').textContent = `${Math.round(currentZoom * 100)}%`;
}

function zoomOut() {
    const summaryContent = document.getElementById('summaryContent');
    currentZoom -= 0.1;
    if (currentZoom < 0.8) currentZoom = 0.8;
    
    if (currentZoom > 1) {
        summaryContent.classList.add('zoomed');
        summaryContent.style.fontSize = `${20 * currentZoom}px`;
    } else {
        summaryContent.classList.remove('zoomed');
    }
    
    document.getElementById('zoomLevel').textContent = `${Math.round(currentZoom * 100)}%`;
}

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ØµÙˆØª
function toggleAudio() {
    const audioBtn = document.getElementById('audioBtn');
    const audioControls = document.getElementById('audioControls');
    
    if (isAudioPlaying) {
        stopAudio();
        audioBtn.textContent = 'ğŸ”Š';
        audioBtn.title = "ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª";
        audioControls.style.display = 'none';
    } else {
        startAudio();
        audioBtn.textContent = 'â¸ï¸';
        audioBtn.title = "Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª Ù…Ø¤Ù‚ØªØ§Ù‹";
        audioControls.style.display = 'flex';
    }
}

function startAudio() {
    const summaryContent = document.getElementById('summaryContent');
    const text = summaryContent.innerText;
    
    if ('speechSynthesis' in window) {
        speechSynthesis = window.speechSynthesis;
        
        // Ø¥Ù„ØºØ§Ø¡ Ø£ÙŠ ÙƒÙ„Ø§Ù… Ø³Ø§Ø¨Ù‚
        speechSynthesis.cancel();
        
        // ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª
        const words = text.split(' ');
        let currentWordIndex = 0;
        
        // ØªØ³Ù„ÙŠØ· Ø§Ù„Ø¶ÙˆØ¡ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        function highlightCurrentWord() {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚
            const summaryContent = document.getElementById('summaryContent');
            const words = summaryContent.innerText.split(' ');
            
            // Ø¥Ù†Ø´Ø§Ø¡ HTML Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ ØªØ³Ù„ÙŠØ· Ø§Ù„Ø¶ÙˆØ¡ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            let newHTML = '';
            words.forEach((word, index) => {
                if (index === currentWordIndex) {
                    newHTML += `<span class="word-highlight">${word}</span> `;
                } else {
                    newHTML += word + ' ';
                }
            });
            
            summaryContent.innerHTML = newHTML;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ utterance Ø¬Ø¯ÙŠØ¯
        currentUtterance = new SpeechSynthesisUtterance(text);
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®ØµØ§Ø¦Øµ
        currentUtterance.lang = 'ar-SA';
        currentUtterance.rate = 0.8;
        currentUtterance.pitch = 1;
        currentUtterance.volume = document.getElementById('volumeSlider').value;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙ‡Ø±Ø³ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ÙƒÙ„Ù…Ø©
        currentUtterance.onboundary = function(event) {
            if (event.name === 'word') {
                currentWordIndex = event.charIndex;
                highlightCurrentWord();
            }
        };
        
        // Ø¹Ù†Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙƒÙ„Ø§Ù…
        currentUtterance.onend = function() {
            isAudioPlaying = false;
            document.getElementById('audioBtn').textContent = 'ğŸ”Š';
            document.getElementById('audioBtn').title = "ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª";
            document.getElementById('audioControls').style.display = 'none';
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ¸Ù„ÙŠÙ„
            const summaryContent = document.getElementById('summaryContent');
            summaryContent.innerHTML = text;
        };
        
        // Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
        currentUtterance.onerror = function(event) {
            console.error('Speech synthesis error:', event);
            stopAudio();
        };
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ÙƒÙ„Ø§Ù…
        speechSynthesis.speak(currentUtterance);
        isAudioPlaying = true;
        
        // ØªØ³Ù„ÙŠØ· Ø§Ù„Ø¶ÙˆØ¡ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
        highlightCurrentWord();
    } else {
        showError('Ù…ÙŠØ²Ø© Ø§Ù„ÙƒÙ„Ø§Ù… ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­');
    }
}

function stopAudio() {
    if (speechSynthesis && (speechSynthesis.speaking || speechSynthesis.pending)) {
        speechSynthesis.cancel();
    }
    
    isAudioPlaying = false;
    const audioBtn = document.getElementById('audioBtn');
    audioBtn.textContent = 'ğŸ”Š';
    audioBtn.title = "ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª";
    document.getElementById('audioControls').style.display = 'none';
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ¸Ù„ÙŠÙ„
    const summaryContent = document.getElementById('summaryContent');
    const text = summaryContent.innerText.replace(/<[^>]*>/g, '');
    summaryContent.innerHTML = text;
}

function changeVolume(value) {
    if (currentUtterance) {
        currentUtterance.volume = value;
    }
}

// Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±Ø³Ù…
function startPenHold() {
    isPenHold = true;
    penHoldTimeout = setTimeout(() => {
        if (isPenHold) {
            showColorPicker();
        }
    }, 1000); // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Ù„Ù…Ø¯Ø© Ø«Ø§Ù†ÙŠØ©
}

function clearPenHold() {
    isPenHold = false;
    clearTimeout(penHoldTimeout);
    
    if (!isColorPickerVisible) {
        toggleDrawingMode();
    }
}

function showColorPicker() {
    const colorOptions = document.getElementById('colorOptions');
    const penTooltip = document.getElementById('penTooltip');
    
    isColorPickerVisible = true;
    colorOptions.classList.add('show');
    
    // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ„Ù…ÙŠØ­ Ù…Ø¤Ù‚Øª
    penTooltip.style.display = 'block';
    penTooltip.style.top = '50px';
    penTooltip.style.right = '50px';
    
    setTimeout(() => {
        penTooltip.style.display = 'none';
    }, 2000);
    
    // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    setTimeout(() => {
        document.addEventListener('click', hideColorPickerOnClick);
    }, 10);
}

function hideColorPickerOnClick(event) {
    const colorOptions = document.getElementById('colorOptions');
    const penBtn = document.getElementById('penBtn');
    
    if (!colorOptions.contains(event.target) && !penBtn.contains(event.target)) {
        hideColorPicker();
    }
}

function hideColorPicker() {
    const colorOptions = document.getElementById('colorOptions');
    isColorPickerVisible = false;
    colorOptions.classList.remove('show');
    document.removeEventListener('click', hideColorPickerOnClick);
}

function selectColor(colorElement) {
    currentColor = colorElement.getAttribute('data-color');
    document.getElementById('penBtn').style.borderColor = currentColor;
    hideColorPicker();
    
    // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø±Ø³Ù… Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙØ¹Ù„Ø§Ù‹
    if (!isDrawingMode) {
        toggleDrawingMode();
    }
}

function toggleDrawingMode() {
    isDrawingMode = !isDrawingMode;
    const penBtn = document.getElementById('penBtn');
    
    if (isDrawingMode) {
        // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø±Ø³Ù…
        document.body.classList.add('drawing-mode');
        penBtn.classList.add('active');
        penBtn.title = "Ø¥Ù„ØºØ§Ø¡ Ø£Ø¯Ø§Ø© Ø§Ù„Ø±Ø³Ù…";
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø³Ù…
        setupCanvas();
        startDrawing();
    } else {
        // Ø¥Ù„ØºØ§Ø¡ ÙˆØ¶Ø¹ Ø§Ù„Ø±Ø³Ù…
        document.body.classList.remove('drawing-mode');
        penBtn.classList.remove('active');
        penBtn.title = "ØªÙØ¹ÙŠÙ„ Ø£Ø¯Ø§Ø© Ø§Ù„Ø±Ø³Ù…";
        penBtn.style.borderColor = '';
        
        // Ø­ÙØ¸ Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        saveDrawing();
        stopDrawing();
    }
}

function setupCanvas() {
    // Ø¶Ø¨Ø· Ø­Ø¬Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø³Ù… Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø³ÙŠØ§Ù‚ Ø§Ù„Ø±Ø³Ù…
    ctx.strokeStyle = currentColor;
    ctx.lineWidth = 3;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
}

function startDrawing() {
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø³ÙˆÙ…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø±Ø³Ù… Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    redrawDrawings();
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('touchstart', startDrawTouch);
    
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('touchmove', drawTouch);
    
    canvas.addEventListener('mouseup', stopDraw);
    canvas.addEventListener('touchend', stopDraw);
    canvas.addEventListener('mouseout', stopDraw);
}

function stopDrawing() {
    // Ø¥Ø²Ø§Ù„Ø© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    canvas.removeEventListener('mousedown', startDraw);
    canvas.removeEventListener('touchstart', startDrawTouch);
    
    canvas.removeEventListener('mousemove', draw);
    canvas.removeEventListener('touchmove', drawTouch);
    
    canvas.removeEventListener('mouseup', stopDraw);
    canvas.removeEventListener('touchend', stopDraw);
    canvas.removeEventListener('mouseout', stopDraw);
}

function startDraw(e) {
    isDrawing = true;
    [lastX, lastY] = getCoordinates(e);
    e.preventDefault();
}

function startDrawTouch(e) {
    isDrawing = true;
    [lastX, lastY] = getCoordinates(e.touches[0]);
    e.preventDefault();
}

function draw(e) {
    if (!isDrawing) return;
    
    const [x, y] = getCoordinates(e);
    
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(x, y);
    ctx.stroke();
    
    [lastX, lastY] = [x, y];
    e.preventDefault();
}

function drawTouch(e) {
    if (!isDrawing) return;
    
    const [x, y] = getCoordinates(e.touches[0]);
    
    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(x, y);
    ctx.stroke();
    
    [lastX, lastY] = [x, y];
    e.preventDefault();
}

function stopDraw() {
    if (isDrawing) {
        isDrawing = false;
        saveCurrentDrawing();
    }
}

function getCoordinates(e) {
    const rect = canvas.getBoundingClientRect();
    return [
        e.clientX - rect.left,
        e.clientY - rect.top
    ];
}

function saveCurrentDrawing() {
    // Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒØµÙˆØ±Ø©
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    drawings.push({
        data: imageData,
        color: ctx.strokeStyle,
        width: ctx.lineWidth
    });
}

function saveDrawing() {
    // Ø­ÙØ¸ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    saveCurrentDrawing();
}

function redrawDrawings() {
    drawings.forEach(drawing => {
        ctx.putImageData(drawing.data, 0, 0);
    });
}

function resetDrawing() {
    drawings = [];
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

// ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function showError(message) {
    const errorMessage = document.getElementById('errorMessage');
    errorMessage.textContent = message;
    errorMessage.style.display = 'block';
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
    setTimeout(() => {
        errorMessage.style.display = 'none';
    }, 5000);
}

function showTemporaryMessage(message) {
    const statusEl = document.getElementById('status');
    const originalText = statusEl.textContent;
    
    statusEl.textContent = message;
    statusEl.style.color = '#27ae60';
    
    setTimeout(() => {
        statusEl.textContent = originalText;
        statusEl.style.color = '';
    }, 3000);
}

function resetApp() {
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    document.getElementById('pdfFile').value = '';
    document.getElementById('status').textContent = 'Ø¬Ø§Ù‡Ø² Ù„Ø±ÙØ¹ Ù…Ù„Ù PDF Ø¬Ø¯ÙŠØ¯';
    document.getElementById('resultsSection').style.display = 'none';
    document.getElementById('rawContent').innerHTML = '';
    document.getElementById('summaryContent').innerHTML = '';
    document.getElementById('errorMessage').style.display = 'none';
    document.getElementById('successMessage').style.display = 'none';
    
    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª
    stopAudio();
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±Ø³Ù…
    if (isDrawingMode) {
        toggleDrawingMode();
    }
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙƒØ¨ÙŠØ±
    currentZoom = 1;
    document.getElementById('zoomLevel').textContent = '100%';
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø²Ø±
    document.getElementById('submitBtn').disabled = false;
    document.getElementById('submitBtn').innerHTML = '<span>ğŸ“¤ Ø±ÙØ¹ ÙˆØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</span>';
}

// Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØµÙØ­Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
window.addEventListener('DOMContentLoaded', () => {
    // Ø¶Ø¨Ø· Ø­Ø¬Ù… Ù„ÙˆØ­Ø© Ø§Ù„Ø±Ø³Ù… Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
    window.addEventListener('resize', () => {
        if (isDrawingMode) {
            setupCanvas();
            redrawDrawings();
        }
    });
    
    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
    const statusEl = document.getElementById('status');
    statusEl.textContent = 'ğŸš€ Ø§Ø±ÙØ¹ Ù…Ù„Ù PDF Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„';
    
    // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØµÙˆØª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…ØªØµÙØ­
    if ('speechSynthesis' in window) {
        window.speechSynthesis.cancel();
    }
});
</script>
</body>
</html>
