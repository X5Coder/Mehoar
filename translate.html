<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ÿπŸàŸÜ - ÿÆÿØŸÖÿ© ÿ™ÿ±ÿ¨ŸÖÿ© PDF</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800;900&family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        :root {
            --bg-color: #F5F1E8;
            --card-color: #FFFFFF;
            --text-primary: #2D3748;
            --text-secondary: #718096;
            --accent-primary: #8B7355;
            --accent-secondary: #A9927D;
            --accent-dark: #5D4037;
            --border-color: #D4A574;
            --border-radius: 16px;
            --border-radius-large: 24px;
            --navbar-height: 70px;
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --success-color: #38A169;
            --error-color: #E53E3E;
            --warning-color: #DD6B20;
            --shadow-light: 0 2px 8px rgba(139, 115, 85, 0.08);
            --shadow-medium: 0 4px 16px rgba(139, 115, 85, 0.12);
            --shadow-heavy: 0 8px 24px rgba(139, 115, 85, 0.15);
            --highlight-color: #FF6B6B;
            --highlight-bg: #FFF5F5;
            --code-bg: #2D3748;
            --code-color: #E2E8F0;
        }
        
        body {
            font-family: 'Almarai', 'Tajawal', -apple-system, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            direction: rtl;
            -webkit-font-smoothing: antialiased;
            width: 100%;
            max-width: 100vw;
            overflow-x: hidden;
            padding-top: env(safe-area-inset-top);
            position: relative;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            transition: opacity 0.3s ease;
            padding: 20px;
            width: 100%;
            height: 100%;
        }
        
        .loading-logo {
            font-family: 'Almarai', sans-serif;
            font-weight: 800;
            font-size: clamp(36px, 10vw, 48px);
            color: var(--accent-primary);
            margin-bottom: 20px;
            letter-spacing: -1px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(139, 115, 85, 0.1);
            border-left-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-family: 'Tajawal', sans-serif;
            color: var(--text-secondary);
            font-size: 1rem;
            text-align: center;
            max-width: 90%;
            line-height: 1.6;
        }
        
        .native-navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--navbar-height);
            background: var(--bg-color);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            z-index: 10000;
            border-bottom: 1px solid rgba(139, 115, 85, 0.1);
            box-shadow: var(--shadow-light);
            width: 100%;
        }
        
        .logo {
            font-family: 'Almarai', sans-serif;
            font-weight: 900;
            font-size: clamp(28px, 8vw, 36px);
            color: var(--accent-primary);
            cursor: pointer;
            transition: var(--transition-smooth);
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .coins-display {
            background: linear-gradient(145deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 8px 16px;
            border-radius: 14px;
            font-weight: 700;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: var(--shadow-light);
            transition: var(--transition-smooth);
            white-space: nowrap;
        }
        
        .main-content {
            padding-top: calc(var(--navbar-height) + 20px);
            padding-left: 16px;
            padding-right: 16px;
            padding-bottom: 40px;
            max-width: 100%;
            margin: 0 auto;
            width: 100%;
        }
        
        .upload-section {
            background: white;
            border-radius: var(--border-radius-large);
            padding: 24px 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-medium);
            text-align: center;
            border: 1px solid rgba(139, 115, 85, 0.1);
            width: 100%;
        }
        
        .section-title {
            font-family: 'Almarai', sans-serif;
            font-size: clamp(1.3rem, 6vw, 1.8rem);
            font-weight: 800;
            color: var(--accent-primary);
            margin-bottom: 8px;
            word-break: break-word;
        }
        
        .section-subtitle {
            font-family: 'Tajawal', sans-serif;
            color: var(--text-secondary);
            font-size: clamp(0.9rem, 4vw, 1rem);
            margin-bottom: 20px;
            font-weight: 400;
            word-break: break-word;
        }
        
        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 30px 16px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: var(--transition-smooth);
            background: rgba(212, 165, 116, 0.05);
            width: 100%;
        }
        
        .upload-area:hover {
            border-color: var(--accent-primary);
            background: rgba(212, 165, 116, 0.1);
        }
        
        .upload-icon {
            font-size: 42px;
            color: var(--accent-primary);
            margin-bottom: 12px;
        }
        
        .upload-text {
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 6px;
            font-weight: 500;
            word-break: break-word;
        }
        
        .upload-hint {
            font-family: 'Tajawal', sans-serif;
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .cost-preview {
            background: rgba(139, 115, 85, 0.05);
            border-radius: var(--border-radius);
            padding: 20px 16px;
            margin-top: 20px;
            border: 1px solid rgba(139, 115, 85, 0.1);
            display: none;
            animation: slideUp 0.3s ease-out;
            width: 100%;
        }
        
        .cost-preview.show {
            display: block;
        }
        
        .cost-title {
            font-family: 'Almarai', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 16px;
            text-align: center;
        }
        
        .cost-details {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .cost-item {
            text-align: center;
            width: 100%;
            padding: 8px 0;
            background: white;
            border-radius: var(--border-radius);
            border: 1px solid rgba(139, 115, 85, 0.1);
        }
        
        .cost-label {
            font-family: 'Tajawal', sans-serif;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .cost-value {
            font-family: 'Almarai', sans-serif;
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--accent-primary);
        }
        
        .cost-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }
        
        .action-btn {
            padding: 14px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-family: 'Almarai', sans-serif;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-smooth);
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .confirm-btn {
            background: linear-gradient(145deg, var(--success-color), #2F855A);
            color: white;
        }
        
        .cancel-btn {
            background: linear-gradient(145deg, var(--error-color), #C53030);
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-light);
        }
        
        .action-btn:active {
            transform: translateY(0);
        }
        
        .language-section {
            background: white;
            border-radius: var(--border-radius-large);
            padding: 24px 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-medium);
            border: 1px solid rgba(139, 115, 85, 0.1);
            display: none;
            animation: slideUp 0.3s ease-out;
            width: 100%;
        }
        
        .language-section.show {
            display: block;
        }
        
        .language-input-container {
            position: relative;
            margin-bottom: 24px;
            width: 100%;
        }
        
        .language-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid rgba(139, 115, 85, 0.2);
            border-radius: var(--border-radius);
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            transition: var(--transition-smooth);
            background: white;
            cursor: pointer;
        }
        
        .language-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(139, 115, 85, 0.1);
        }
        
        .languages-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid var(--accent-primary);
            border-radius: var(--border-radius);
            margin-top: 5px;
            max-height: 250px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            box-shadow: var(--shadow-heavy);
            width: 100%;
        }
        
        .languages-dropdown.show {
            display: block;
        }
        
        .language-option {
            padding: 12px 18px;
            cursor: pointer;
            transition: var(--transition-smooth);
            border-bottom: 1px solid rgba(139, 115, 85, 0.1);
            font-family: 'Tajawal', sans-serif;
            font-size: 0.95rem;
        }
        
        .language-option:last-child {
            border-bottom: none;
        }
        
        .language-option:hover {
            background: rgba(139, 115, 85, 0.05);
        }
        
        .processing-info {
            text-align: center;
            margin: 20px 0;
            padding: 16px;
            background: rgba(139, 115, 85, 0.05);
            border-radius: var(--border-radius);
            width: 100%;
        }
        
        .translate-btn {
            background: linear-gradient(145deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 14px 24px;
            font-family: 'Almarai', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-smooth);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin: 0 auto;
        }
        
        .translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .result-section {
            background: var(--bg-color);
            border-radius: var(--border-radius-large);
            padding: 0;
            margin-bottom: 20px;
            display: none;
            animation: slideUp 0.3s ease-out;
            width: 100%;
        }
        
        .result-section.show {
            display: block;
        }
        
        .result-header {
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: flex-start;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(139, 115, 85, 0.1);
            background: white;
            border-radius: var(--border-radius-large) var(--border-radius-large) 0 0;
            margin-bottom: 16px;
            width: 100%;
        }
        
        .result-title {
            font-family: 'Almarai', sans-serif;
            font-size: clamp(1.2rem, 5vw, 1.5rem);
            font-weight: 800;
            color: var(--accent-primary);
            word-break: break-word;
        }
        
        .result-toolbar {
            display: flex;
            align-items: center;
            gap: 12px;
            width: 100%;
            justify-content: flex-start;
        }
        
        .font-controls-result {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(139, 115, 85, 0.05);
            padding: 6px 12px;
            border-radius: 14px;
            width: auto;
        }
        
        .font-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: white;
            border: 1px solid rgba(139, 115, 85, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            font-weight: 700;
            font-size: 16px;
            color: var(--accent-primary);
        }
        
        .pages-container {
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            width: 100%;
        }
        
        .page-wrapper {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-medium);
            padding: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            margin: 0 auto;
            width: 100%;
            max-width: 100%;
            border: 1px solid rgba(139, 115, 85, 0.1);
        }
        
        .page-header {
            background: linear-gradient(145deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: flex-start;
            border-bottom: 1px solid rgba(139, 115, 85, 0.1);
            width: 100%;
        }
        
        .page-number {
            font-family: 'Almarai', sans-serif;
            font-weight: 700;
            font-size: 1rem;
        }
        
        .page-copy-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            padding: 6px 14px;
            color: white;
            font-family: 'Tajawal', sans-serif;
            font-size: 0.85rem;
            cursor: pointer;
            transition: var(--transition-smooth);
            display: flex;
            align-items: center;
            gap: 6px;
            width: auto;
        }
        
        .page-content {
            padding: 20px 16px;
            font-family: 'Tajawal', sans-serif;
            line-height: 1.7;
            color: var(--text-primary);
            min-height: auto;
            transition: all 0.3s ease;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            word-break: break-word;
            width: 100%;
            max-width: 100%;
        }
        
        .highlighted-text {
            background-color: var(--highlight-bg);
            color: var(--highlight-color);
            font-weight: 700;
            padding: 2px 6px;
            border-radius: 4px;
            margin: 0 2px;
            display: inline-block;
            border: 1px solid rgba(255, 107, 107, 0.2);
        }
        
        .code-block {
            background: var(--code-bg);
            color: var(--code-color);
            border-radius: 8px;
            padding: 16px;
            margin: 12px 0;
            overflow-x: auto;
            position: relative;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            border-left: 4px solid var(--accent-secondary);
            width: 100%;
            max-width: 100%;
        }
        
        .code-header {
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: flex-start;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
        }
        
        .code-label {
            color: var(--accent-secondary);
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .copy-code-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 5px 12px;
            color: white;
            font-family: 'Tajawal', sans-serif;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition-smooth);
            display: flex;
            align-items: center;
            gap: 5px;
            width: auto;
        }
        
        .code-content {
            overflow-x: auto;
            padding: 8px 0;
            width: 100%;
        }
        
        .code-content pre {
            white-space: pre-wrap;
            word-break: break-word;
            font-family: inherit;
            font-size: 0.85rem;
            width: 100%;
        }
        
        .footer {
            text-align: center;
            padding: 30px 16px;
            color: var(--text-secondary);
            border-top: 1px solid rgba(139, 115, 85, 0.1);
            margin-top: 30px;
            position: relative;
            z-index: 1;
            width: 100%;
        }
        
        .copyright {
            font-family: 'Tajawal', sans-serif;
            font-size: 0.85rem;
            line-height: 1.6;
            margin-bottom: 20px;
            font-weight: 400;
            word-break: break-word;
        }
        
        .support-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .support-title {
            font-family: 'Almarai', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent-primary);
            margin-bottom: 4px;
        }
        
        .support-links {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .support-link {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: linear-gradient(145deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            box-shadow: var(--shadow-light);
        }
        
        .support-link i {
            font-size: 20px;
            color: white;
        }
        
        .developer-credit {
            font-family: 'Tajawal', sans-serif;
            font-size: 0.8rem;
            color: rgba(100, 116, 139, 0.6);
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(139, 115, 85, 0.05);
            cursor: pointer;
            transition: var(--transition-smooth);
            word-break: break-word;
        }
        
        .notification {
            position: fixed;
            top: 80px;
            left: 16px;
            right: 16px;
            background: white;
            border-radius: 14px;
            padding: 14px 16px;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(139, 115, 85, 0.1);
            z-index: 10001;
            width: auto;
            max-width: calc(100% - 32px);
            transform: translateY(-120%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 0 auto;
        }
        
        .notification.show {
            transform: translateY(0);
        }
        
        .notification.success {
            border-right: 4px solid var(--success-color);
        }
        
        .notification.error {
            border-right: 4px solid var(--error-color);
        }
        
        .notification-content {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification-icon {
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .notification.success .notification-icon {
            color: var(--success-color);
        }
        
        .notification.error .notification-icon {
            color: var(--error-color);
        }
        
        .notification-text {
            font-family: 'Tajawal', sans-serif;
            font-size: 0.9rem;
            word-break: break-word;
            flex: 1;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @media (max-width: 360px) {
            :root {
                --navbar-height: 60px;
            }
            
            .logo {
                font-size: 24px;
            }
            
            .coins-display {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .upload-icon {
                font-size: 36px;
            }
            
            .section-title {
                font-size: 1.2rem;
            }
            
            .page-content {
                padding: 16px 12px;
                font-size: 14px;
            }
            
            .code-block {
                padding: 12px;
            }
        }
        
        @media (min-width: 768px) {
            .main-content {
                padding-left: 20px;
                padding-right: 20px;
                max-width: 1200px;
            }
            
            .cost-actions {
                flex-direction: row;
            }
            
            .result-header {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
            
            .result-toolbar {
                width: auto;
            }
            
            .page-header {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
            
            .code-header {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
            
            .notification {
                left: auto;
                right: 20px;
                width: 320px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loading-screen" style="display: none;">
        <div class="loading-logo">ÿπŸàŸÜ</div>
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</div>
    </div>
    
    <div class="notification" id="notification">
        <div class="notification-content">
            <div class="notification-icon" id="notification-icon">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="notification-text" id="notification-text"></div>
        </div>
    </div>
    
    <nav class="native-navbar" id="navbar">
        <div class="logo" id="home-logo" onclick="reloadPage()">ÿπŸàŸÜ</div>
        <div class="nav-left">
            <div class="coins-display">
                <i class="fas fa-coins"></i>
                <span id="coins-count">0</span>
            </div>
        </div>
    </nav>
    
    <div class="main-content" id="main-content">
        <section class="upload-section" id="upload-section">
            <h1 class="section-title">ÿÆÿØŸÖÿ© ÿ™ÿ±ÿ¨ŸÖÿ© PDF</h1>
            <p class="section-subtitle">ÿßÿ±ŸÅÿπ ŸÖŸÑŸÅ PDF ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ Ÿàÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ™ÿ±ÿ¨ŸÖÿ© ŸÉÿßŸÖŸÑÿ© ÿ®ÿØŸÇÿ© ÿπÿßŸÑŸäÿ©</p>
            
            <div class="upload-area" id="upload-area" onclick="document.getElementById('pdfFile').click()">
                <div class="upload-icon">
                    <i class="fas fa-file-pdf"></i>
                </div>
                <div class="upload-text" id="upload-text">ÿßŸÜŸÇÿ± ŸÑÿ±ŸÅÿπ ŸÖŸÑŸÅ PDF</div>
                <div class="upload-hint">ÿ£Ÿà ÿßÿ≥ÿ≠ÿ® Ÿàÿ£ŸÅŸÑÿ™ ÿßŸÑŸÖŸÑŸÅ ŸáŸÜÿß</div>
            </div>
            
            <input type="file" id="pdfFile" accept=".pdf" style="display: none;">
            
            <div class="cost-preview" id="cost-preview">
                <h3 class="cost-title">ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑÿ™ŸÉŸÑŸÅÿ©</h3>
                <div class="cost-details">
                    <div class="cost-item">
                        <div class="cost-label">ÿπÿØÿØ ÿßŸÑÿµŸÅÿ≠ÿßÿ™</div>
                        <div class="cost-value" id="page-count">0</div>
                    </div>
                    <div class="cost-item">
                        <div class="cost-label">ÿßŸÑÿ™ŸÉŸÑŸÅÿ©</div>
                        <div class="cost-value" id="cost-amount">0 ÿπŸÖŸÑÿ©</div>
                    </div>
                </div>
                <div class="cost-actions">
                    <button class="action-btn cancel-btn" onclick="cancelProcess()">
                        <i class="fas fa-times"></i>
                        ÿ•ŸÑÿ∫ÿßÿ°
                    </button>
                    <button class="action-btn confirm-btn" onclick="confirmProcess()">
                        <i class="fas fa-check"></i>
                        ŸÖÿ™ÿßÿ®ÿπÿ©
                    </button>
                </div>
            </div>
        </section>
        
        <section class="language-section" id="language-section">
            <h2 class="section-title">ÿßÿÆÿ™ÿ± ŸÑÿ∫ÿ© ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©</h2>
            <p class="section-subtitle">ÿßÿÆÿ™ÿ± ÿßŸÑŸÑÿ∫ÿ© ÿßŸÑÿ™Ÿä ÿ™ÿ±ŸäÿØ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ÿ•ŸÑŸäŸáÿß</p>
            
            <div class="language-input-container">
                <input type="text" class="language-input" id="language-input" placeholder="ÿßŸÜŸÇÿ± ŸÑÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑŸÑÿ∫ÿ©" readonly>
                <div class="languages-dropdown" id="languages-dropdown"></div>
            </div>
            
            <div class="processing-info">
                <p style="font-family: 'Tajawal'; color: var(--text-secondary); margin-bottom: 8px;">
                    <i class="fas fa-clock"></i>
                    ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ŸÇÿØ ÿ™ÿ≥ÿ™ÿ∫ÿ±ŸÇ ÿ®ÿ∂ÿπ ÿØŸÇÿßÿ¶ŸÇ
                </p>
                <p style="font-family: 'Tajawal'; font-size: 0.85rem; color: var(--text-secondary);">
                    ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ±ÿ¨ŸÖÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿµŸÅÿ≠ÿßÿ™ ÿ®ÿØŸÇÿ© ÿπÿßŸÑŸäÿ© ŸÖÿπ ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸâ ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ
                </p>
            </div>
            
            <button class="translate-btn" id="translate-btn" onclick="startTranslation()">
                <i class="fas fa-language"></i>
                ÿ®ÿØÿ° ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©
            </button>
        </section>
        
        <section class="result-section" id="result-section">
            <div class="result-header">
                <h2 class="result-title" id="result-title">ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©</h2>
                <div class="result-toolbar">
                    <div class="font-controls-result">
                        <button class="font-btn" onclick="changeFontSize('decrease')">-</button>
                        <span style="font-weight: 600; color: var(--accent-primary); padding: 0 6px; font-size: 0.9rem;">ÿ≠ÿ¨ŸÖ ÿßŸÑÿÆÿ∑</span>
                        <button class="font-btn" onclick="changeFontSize('increase')">+</button>
                    </div>
                </div>
            </div>
            
            <div class="pages-container" id="pages-container"></div>
        </section>
        
        <footer class="footer">
            <p class="copyright">ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÇ ŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸÑŸÖŸÜÿµÿ© ÿπŸàŸÜ ¬© 2026</p>
            
            <div class="support-section">
                <div class="support-title">ÿßŸÑÿØÿπŸÖ ÿßŸÑŸÅŸÜŸä</div>
                <div class="support-links">
                    <a href="https://wa.me/966583617539" target="_blank" class="support-link">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="https://t.me/HNHv1" target="_blank" class="support-link">
                        <i class="fab fa-telegram"></i>
                    </a>
                </div>
            </div>
            
            <div class="developer-credit" onclick="window.open('https://t.me/X5Coder', '_blank')">
                ÿ®ÿ±ŸÖÿ¨ÿ© ÿßŸÑŸÖÿ∑Ÿàÿ± ùêäùêàùêåùêé
            </div>
        </footer>
    </div>
    
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        firebase.initializeApp({
            apiKey: "AIzaSyBmPMRk4pvowUnqQb3fCSTZqLRNiU6-ouo",
            authDomain: "marvel1-654dd.firebaseapp.com",
            databaseURL: "https://marvel1-654dd-default-rtdb.firebaseio.com",
            projectId: "marvel1-654dd",
            storageBucket: "marvel1-654dd.appspot.com",
            messagingSenderId: "189921979866",
            appId: "1:189921979866:android:95f48de58a69756be924e3"
        });

        const auth = firebase.auth();
        const database = firebase.database();
        
        let currentUser = null;
        let userCoins = 0;
        let selectedFile = null;
        let fileInfo = { name: '', size: 0, pages: 0, words: 0, cost: 0, finalCost: 0 };
        let selectedLanguage = '';
        
        const languages = [
            "ÿßŸÑÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿ©", "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©", "ÿßŸÑÿ•ÿ≥ÿ®ÿßŸÜŸäÿ©", "ÿßŸÑŸÅÿ±ŸÜÿ≥Ÿäÿ©", "ÿßŸÑÿ£ŸÑŸÖÿßŸÜŸäÿ©", "ÿßŸÑÿµŸäŸÜŸäÿ©", "ÿßŸÑŸäÿßÿ®ÿßŸÜŸäÿ©", "ÿßŸÑŸÉŸàÿ±Ÿäÿ©",
            "ÿßŸÑÿ±Ÿàÿ≥Ÿäÿ©", "ÿßŸÑÿ®ÿ±ÿ™ÿ∫ÿßŸÑŸäÿ©", "ÿßŸÑÿ•Ÿäÿ∑ÿßŸÑŸäÿ©", "ÿßŸÑŸáŸàŸÑŸÜÿØŸäÿ©", "ÿßŸÑÿ™ÿ±ŸÉŸäÿ©", "ÿßŸÑŸÅÿßÿ±ÿ≥Ÿäÿ©", "ÿßŸÑÿ£ÿ±ÿØŸäÿ©", "ÿßŸÑŸáŸÜÿØŸäÿ©"
        ];
        
        const SERVER = "https://wet-aidan-kimon-66eadaf6.koyeb.app";
        const ID = "12345";
        const PASS = "12345abcde57";
        
        let currentFontSize = 16;
        const minFontSize = 12;
        const maxFontSize = 22;
        
        function reloadPage() { location.reload(); }
        
        function showNotification(message, type = 'info') {
            const n = document.getElementById('notification');
            const i = document.getElementById('notification-icon');
            const t = document.getElementById('notification-text');
            t.textContent = message;
            n.className = 'notification';
            if(type === 'success') { n.classList.add('success'); i.innerHTML = '<i class="fas fa-check-circle"></i>'; }
            else if(type === 'error') { n.classList.add('error'); i.innerHTML = '<i class="fas fa-exclamation-circle"></i>'; }
            else { i.innerHTML = '<i class="fas fa-info-circle"></i>'; }
            n.classList.add('show');
            setTimeout(() => n.classList.remove('show'), 3000);
        }
        
        function changeFontSize(a) {
            const c = document.querySelectorAll('.page-content');
            if(a === 'increase' && currentFontSize < maxFontSize) currentFontSize += 1;
            else if(a === 'decrease' && currentFontSize > minFontSize) currentFontSize -= 1;
            c.forEach(e => { e.style.fontSize = currentFontSize + 'px'; adjustPageHeight(e.closest('.page-wrapper')); });
        }
        
        function adjustPageHeight(w) { if(!w) return; const c = w.querySelector('.page-content'); if(c) w.style.minHeight = (c.scrollHeight + 40) + 'px'; }
        
        async function loadUserData() {
            const user = auth.currentUser;
            if(!user) { window.location.replace('login.html'); return; }
            const snapshot = await database.ref('users_Awn').once('value');
            if(snapshot.exists()) {
                const users = snapshot.val();
                for(const [id, d] of Object.entries(users)) {
                    if(id !== 'noty_publick' && d.email === user.email) {
                        currentUser = { id, email: d.email, name: d.name || '', coin: d.coin || 0, admin: d.admin === true, banned: d.banned === true };
                        userCoins = d.coin || 0;
                        document.getElementById('coins-count').textContent = userCoins;
                        return;
                    }
                }
            }
            await auth.signOut();
            window.location.replace('login.html');
        }
        
        async function setupUser() {
            await loadUserData();
            if(!currentUser || currentUser.banned) window.location.replace('login.html');
        }
        
        function setupFileUpload() {
            const i = document.getElementById('pdfFile');
            const a = document.getElementById('upload-area');
            if(i) i.addEventListener('change', handleFileSelect);
            if(a) { a.addEventListener('dragover', (e) => { e.preventDefault(); a.style.borderColor = 'var(--accent-primary)'; a.style.backgroundColor = 'rgba(139,115,85,0.1)'; }); a.addEventListener('drop', handleDrop); }
        }
        
        async function handleDrop(e) { e.preventDefault(); const f = e.dataTransfer.files; if(f.length > 0) await handleFile(f[0]); }
        async function handleFileSelect(e) { const f = e.target.files[0]; if(f) await handleFile(f); }
        
        async function handleFile(file) {
            if(!file.name.toLowerCase().endsWith('.pdf')) { showNotification('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ±ŸÅÿπ ŸÖŸÑŸÅ PDF', 'error'); resetFileInput(); return; }
            selectedFile = file;
            document.getElementById('upload-text').textContent = file.name;
            document.getElementById('upload-area').style.borderColor = 'var(--accent-primary)';
            document.getElementById('upload-area').style.backgroundColor = 'rgba(212,165,116,0.1)';
            await analyzePDF(file);
        }
        
        async function analyzePDF(file) {
            try {
                showLoading('ÿπŸàŸÜ Ÿäÿ≠ŸÑŸÑ ÿßŸÑŸÖŸÑŸÅ...');
                const buffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(buffer).promise;
                let totalWords = 0;
                for(let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    if(content.items.length > 0) {
                        let text = '';
                        content.items.forEach(t => text += t.str + ' ');
                        totalWords += text.trim().split(/\s+/).filter(w => w.length >= 2).length;
                    } else totalWords += 250;
                }
                let coins = Math.ceil((totalWords / 1000) * 2) / 2;
                if(coins < 1) coins = 1;
                coins = Math.round(coins * 10) / 10;
                fileInfo = { name: file.name, size: file.size, pages: pdf.numPages, words: totalWords, cost: coins, finalCost: coins * 2 };
                hideLoading();
                document.getElementById('page-count').textContent = fileInfo.pages;
                document.getElementById('cost-amount').textContent = fileInfo.finalCost + ' ÿπŸÖŸÑÿ©';
                document.getElementById('cost-preview').classList.add('show');
                showNotification('ÿ™ŸÖ ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÑŸÅ', 'success');
            } catch(e) { hideLoading(); showNotification('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÖŸÑŸÅ', 'error'); resetFileInput(); }
        }
        
        function resetFileInput() {
            document.getElementById('pdfFile').value = '';
            selectedFile = null;
            document.getElementById('upload-text').textContent = 'ÿßŸÜŸÇÿ± ŸÑÿ±ŸÅÿπ ŸÖŸÑŸÅ PDF';
            const a = document.getElementById('upload-area');
            a.style.borderColor = ''; a.style.backgroundColor = '';
            document.getElementById('cost-preview').classList.remove('show');
        }
        
        function cancelProcess() { resetFileInput(); showNotification('ÿ™ŸÖ ÿßŸÑÿ•ŸÑÿ∫ÿßÿ°', 'info'); }
        
        function confirmProcess() {
            if(!fileInfo.finalCost || userCoins < fileInfo.finalCost) { showNotification('ÿ±ÿµŸäÿØ ÿ∫Ÿäÿ± ŸÉÿßŸÅ', 'error'); return; }
            document.getElementById('upload-section').style.display = 'none';
            document.getElementById('language-section').classList.add('show');
            document.getElementById('cost-preview').classList.remove('show');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function setupLanguageSelection() {
            const i = document.getElementById('language-input');
            const d = document.getElementById('languages-dropdown');
            i.addEventListener('click', () => { d.classList.toggle('show'); populateLanguages(); });
            document.addEventListener('click', (e) => { if(!i.contains(e.target) && !d.contains(e.target)) d.classList.remove('show'); });
        }
        
        function populateLanguages() {
            const d = document.getElementById('languages-dropdown');
            d.innerHTML = '';
            languages.forEach(l => {
                const o = document.createElement('div');
                o.className = 'language-option';
                o.textContent = l;
                o.onclick = () => { selectLanguage(l); };
                d.appendChild(o);
            });
        }
        
        function selectLanguage(l) {
            selectedLanguage = l;
            document.getElementById('language-input').value = l;
            document.getElementById('languages-dropdown').classList.remove('show');
            showNotification(`ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ± ${l}`, 'success');
        }
        
        function createPrompt() {
            return `SYSTEM MODE: CONTROLLED EXECUTION ENGINE

You are a non-conversational processing engine.
You execute tasks only.

PRIORITY RULE:
You MUST strictly follow the output schema.
You MUST NOT add explanations.
You MUST NOT add comments.
You MUST NOT add confirmations.
You MUST NOT say "Sure", "Here is", or anything else.
You MUST return JSON ONLY.
If you output anything outside JSON ‚Üí it is considered FAILURE.

====================================================
TASK: FULL PDF TRANSLATION ENGINE
====================================================

INPUT:
- A PDF file.
- ONE required parameter:
  target_language = ${selectedLanguage}

If "target_language" is missing, null, empty, or undefined:
Return exactly:
ERROR

No extra text.

====================================================
CORE BEHAVIOR RULES
====================================================

1) You MUST read and fully analyze the entire PDF before generating output.

2) You MUST detect:
   - Total number of pages.
   - Original language of the document.

3) You MUST translate:
   - EVERY word.
   - EVERY sentence.
   - EVERY paragraph.
   - WITHOUT summarizing.
   - WITHOUT skipping.
   - WITHOUT compressing.
   - WITHOUT losing formatting meaning.

4) You MUST preserve:
   - Line breaks.
   - Paragraph spacing.
   - Bullet structures.
   - Symbols.
   - Layout structure in text form.
   - Sequence of lines exactly as they appear.

5) If a page contains:
   - Images with text ‚Üí Extract and translate the text.
   - Scanned content ‚Üí Perform OCR and translate.
   - Mixed content ‚Üí Translate textual parts only.
   - Code blocks ‚Üí DO NOT translate code.

6) Code Handling Rule:
   Any detected programming code MUST remain EXACTLY as original.
   It MUST be returned wrapped like this:
   \`\`\`code_here_exactly_as_original\`\`

7) If a sentence appears important or looks like a title,
   wrap it using exactly:
   **Important Sentence Here**

8) You MUST translate into the exact "target_language" specified.
   No fallback language allowed.

====================================================
ERROR HANDLING
====================================================

Return exactly:
ERROR

ONLY IF:
- The file is empty.
- The file is corrupted.
- The file cannot be parsed.
- The content is unreadable nonsense.
- target_language is missing.

No explanation.
No extra characters.

====================================================
OUTPUT FORMAT (STRICT JSON ONLY)
====================================================

{
  "pages": <number_of_pages>,
  "language": "<detected_original_language>",
  "translation": "<target_language>",
  "page1": "<fully translated content preserving structure>",
  "page2": "<fully translated content preserving structure>",
  "page3": "<fully translated content preserving structure>"
}

Continue dynamically:
page4 ...
page5 ...
Until ALL pages are translated.

Rules:
- Keys must be sequential.
- No missing pages.
- No extra keys.
- No comments.
- No markdown.
- No text outside JSON.
- No trailing commas.
- Valid JSON only.

====================================================
ABSOLUTE RESTRICTION
====================================================

You are NOT allowed to:
- Explain anything.
- Apologize.
- Add notes.
- Add warnings.
- Add metadata.
- Add formatting outside JSON.
- Add \`\`\`json fences.
- Add text before or after JSON.

Return JSON ONLY.
Execution only.`;
        }
        
        async function startTranslation() {
            if(!selectedFile) { showNotification('ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅ PDF', 'error'); return; }
            if(!selectedLanguage) { showNotification('ÿßÿÆÿ™ÿ± ŸÑÿ∫ÿ©', 'error'); return; }
            if(userCoins < fileInfo.finalCost) { showNotification('ÿ±ÿµŸäÿØ ÿ∫Ÿäÿ± ŸÉÿßŸÅ', 'error'); return; }
            
            const btn = document.getElementById('translate-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©...';
            
            try {
                showLoading('ÿπŸàŸÜ Ÿäÿ™ÿ±ÿ¨ŸÖ...');
                
                const base64 = await new Promise((r, j) => {
                    const reader = new FileReader();
                    reader.onload = () => r(reader.result.split(',')[1]);
                    reader.onerror = j;
                    reader.readAsDataURL(selectedFile);
                });
                
                const response = await fetch(SERVER + "/api/KIMO_DEV", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ id: ID, pass: PASS, data: createPrompt(), PDF_BASE64: base64 })
                });
                
                if(!response.ok) throw new Error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ≥Ÿäÿ±ŸÅÿ±');
                
                const responseText = await response.text();
                let result = null;
                
                try { result = JSON.parse(responseText); } 
                catch(e) {
                    const match = responseText.match(/\{[\s\S]*\}/);
                    if(match) { try { result = JSON.parse(match[0]); } catch(e2) {} }
                }
                
                if(!result) throw new Error('ÿ±ÿØ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠');
                if(result === "ERROR" || result.error === "ERROR" || result.pages === "ERROR") throw new Error('ÿßŸÑŸÖŸÑŸÅ ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠');
                
                hideLoading();
                
                userCoins -= fileInfo.finalCost;
                await database.ref(`users_Awn/${currentUser.id}/coin`).set(userCoins);
                document.getElementById('coins-count').textContent = userCoins;
                
                const id = 'translation_' + Date.now();
                await database.ref(`records/${id}`).set({
                    id: currentUser.id, process: 'ÿ™ÿ±ÿ¨ŸÖÿ©', data: result,
                    timestamp: Date.now(), fileName: fileInfo.name,
                    cost: fileInfo.finalCost, pages: fileInfo.pages, language: selectedLanguage
                });
                
                displayResult(result);
                
                document.getElementById('language-section').classList.remove('show');
                document.getElementById('result-section').classList.add('show');
                window.scrollTo({ top: 0, behavior: 'smooth' });
                showNotification('ÿ™ŸÖÿ™ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©', 'success');
                
            } catch(e) {
                hideLoading();
                showNotification(e.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-language"></i> ÿ®ÿØÿ° ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ©';
            }
        }
        
        function formatContent(text) {
            if(!text) return '';
            let f = text.replace(/\*\*(.*?)\*\*/g, '<span class="highlighted-text">$1</span>');
            const blocks = f.match(/```[\s\S]*?```/g);
            if(blocks) {
                blocks.forEach((b, i) => {
                    const code = b.replace(/```/g, '').trim();
                    const id = 'c' + Date.now() + i;
                    const html = `<div class="code-block"><div class="code-header"><div class="code-label">ŸÉŸàÿØ</div><button class="copy-code-btn" onclick="copyCode('${id}')"><i class="far fa-copy"></i> ŸÜÿ≥ÿÆ</button></div><div class="code-content"><pre id="${id}">${escapeHtml(code)}</pre></div></div>`;
                    f = f.replace(b, html);
                });
            }
            return f.replace(/\n/g, '<br>');
        }
        
        function escapeHtml(t) {
            return t.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
        }
        
        function copyCode(id) {
            const e = document.getElementById(id);
            if(e) navigator.clipboard.writeText(e.textContent).then(() => showNotification('ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ', 'success'));
        }
        
        function copyPageContent(n) {
            const e = document.getElementById(`page-content-${n}`);
            if(e) navigator.clipboard.writeText(e.textContent).then(() => showNotification(`ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿµŸÅÿ≠ÿ© ${n}`, 'success'));
        }
        
        function displayResult(r) {
            document.getElementById('result-title').textContent = `ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ÿ•ŸÑŸâ ${selectedLanguage}`;
            const container = document.getElementById('pages-container');
            container.innerHTML = '';
            
            let total = r.pages || 0;
            if(total === 0) total = Object.keys(r).filter(k => k.startsWith('page') && k !== 'pages' && !isNaN(parseInt(k.replace('page', '')))).length;
            
            for(let i = 1; i <= total; i++) {
                const key = `page${i}`;
                let content = r[key] || '';
                content = content.replace(/^[\s\n]+|[\s\n]+$/g, '').replace(/\n{3,}/g, '\n\n');
                
                const wrapper = document.createElement('div');
                wrapper.className = 'page-wrapper';
                wrapper.id = `page-${i}`;
                wrapper.innerHTML = `
                    <div class="page-header">
                        <div class="page-number">ÿµŸÅÿ≠ÿ© ${i}</div>
                        <button class="page-copy-btn" onclick="copyPageContent(${i})">
                            <i class="far fa-copy"></i> ŸÜÿ≥ÿÆ
                        </button>
                    </div>
                    <div class="page-content" id="page-content-${i}" style="font-size: ${currentFontSize}px;">
                        ${formatContent(content)}
                    </div>
                `;
                container.appendChild(wrapper);
                setTimeout(() => adjustPageHeight(wrapper), 50);
            }
            
            const info = document.createElement('div');
            info.style.cssText = 'text-align: center; margin-top: 20px; padding: 16px; background: rgba(139,115,85,0.05); border-radius: var(--border-radius); width: 100%;';
            info.innerHTML = `<p style="font-family: Tajawal; color: var(--text-secondary);"><i class="fas fa-info-circle"></i> ÿ™ŸÖÿ™ ÿßŸÑÿ™ÿ±ÿ¨ŸÖÿ© ŸÖŸÜ ${r.language || 'ÿßŸÑÿ£ÿµŸÑŸäÿ©'} ÿ•ŸÑŸâ ${selectedLanguage}</p><p style="font-family: Tajawal; font-size: 0.85rem; color: var(--text-secondary); margin-top: 8px;">ÿßŸÑÿµŸÅÿ≠ÿßÿ™: ${total} | ÿßŸÑÿ™ŸÉŸÑŸÅÿ©: ${fileInfo.finalCost} ÿπŸÖŸÑÿ©</p>`;
            container.appendChild(info);
        }
        
        function showLoading(t = 'ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...') {
            const s = document.getElementById('loading-screen');
            const l = document.getElementById('loading-text');
            l.textContent = t;
            s.style.display = 'flex';
            setTimeout(() => s.style.opacity = '1', 10);
        }
        
        function hideLoading() {
            const s = document.getElementById('loading-screen');
            s.style.opacity = '0';
            setTimeout(() => s.style.display = 'none', 300);
        }
        
        async function initApp() {
            showLoading();
            const u = auth.onAuthStateChanged(async (user) => {
                if(!user) { hideLoading(); window.location.replace('login.html'); return; }
                try {
                    await setupUser();
                    setupFileUpload();
                    setupLanguageSelection();
                    hideLoading();
                } catch(e) { hideLoading(); showNotification('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ', 'error'); }
                setTimeout(() => u(), 100);
            });
        }
        
        history.pushState(null, null, window.location.href);
        window.addEventListener('popstate', () => history.pushState(null, null, window.location.href));
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
